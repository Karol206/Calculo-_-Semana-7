<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Derivadas Paso a Paso</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    input, button {
      font-size: 1rem;
      padding: 10px;
      margin-top: 10px;
    }
    pre {
      background-color: #fff;
      padding: 15px;
      border-radius: 10px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>Calculadora de Derivadas Paso a Paso</h1>
  <label for="funcion">Ingresa la función (ej: 2x^2):</label><br>
  <input type="text" id="funcion" placeholder="Ej: 2x^2"><br>
  <button onclick="resolverDerivada()">Resolver Derivada</button>
  <h2>Pasos:</h2>
  <pre id="pasos"></pre>
  <h2>Gráfica:</h2>
  <canvas id="grafico" width="600" height="400"></canvas>

  <script>
    function derivadaPasoAPaso(fx) {
      const pasos = [];
      pasos.push(`Función original: f(x) = ${fx}`);
      
      // Expandir (x + Δx)
      const fxParsed = math.parse(fx);
      const variable = 'x';
      const delta = math.parse(`(${fx})`.replace(/x/g, '(x + dx)'));

      pasos.push(`Paso 1: Aplicar la definición de derivada:`);
      pasos.push(`f'(x) = lim dx->0 [f(x + dx) - f(x)] / dx`);

      pasos.push(`Paso 2: f(x + dx) = ${delta.toString()}`);
      pasos.push(`Paso 3: f(x + dx) - f(x) = (${delta.toString()}) - (${fx})`);

      const num = math.simplify(`(${delta.toString()}) - (${fx})`).toString();
      pasos.push(`Paso 4: Numerador simplificado: ${num}`);

      const division = math.simplify(`(${num}) / dx`).toString();
      pasos.push(`Paso 5: Dividir por dx: (${num}) / dx = ${division}`);

      const derivada = math.derivative(fx, variable).toString();
      pasos.push(`Paso 6: Tomar el límite cuando dx -> 0: f'(x) = ${derivada}`);

      return { pasos, derivada };
    }

    function resolverDerivada() {
      const funcion = document.getElementById("funcion").value;
      const { pasos, derivada } = derivadaPasoAPaso(funcion);

      document.getElementById("pasos").innerText = pasos.join("\n");
      graficar(funcion, derivada);
    }

    function graficar(funcion, derivada) {
      const ctx = document.getElementById('grafico').getContext('2d');
      const xVals = math.range(-10, 10, 0.1).toArray();
      const f = math.compile(funcion);
      const df = math.compile(derivada);

      const yVals = xVals.map(x => f.evaluate({x}));
      const dyVals = xVals.map(x => df.evaluate({x}));

      new Chart(ctx, {
        type: 'line',
        data: {
          labels: xVals,
          datasets: [
            {
              label: 'f(x)',
              data: yVals,
              borderColor: 'blue',
              fill: false
            },
            {
              label: "f'(x)",
              data: dyVals,
              borderColor: 'red',
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            x: {
              title: {
                display: true,
                text: 'x'
              }
            },
            y: {
              title: {
                display: true,
                text: 'f(x), f\'(x)'
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
