<script>
  let chart;

  function calcularDominioRango() {
    const exprInput = document.getElementById('funcion').value;
    const intervalo = document.getElementById('intervalo').value;
    const partes = intervalo.split(',').map(Number);

    if (partes.length !== 2 || isNaN(partes[0]) || isNaN(partes[1])) {
      alert("Intervalo inválido. Usa el formato: -10,10");
      return;
    }

    const [xInicio, xFin] = partes;
    const expr = math.compile(exprInput);

    let xVals = [], yVals = [], dominio = [], rango = [];

    for (let x = xInicio; x <= xFin; x += 0.1) {
      try {
        const y = expr.evaluate({x});
        if (isFinite(y)) {
          xVals.push(x.toFixed(2));
          yVals.push(y);
          dominio.push(x);
          rango.push(y);
        }
      } catch (e) {
        // Mostrar error si es necesario
        console.log("Error:", e.message);
      }
    }

    if (rango.length === 0) {
      document.getElementById('resultado').innerHTML = "No se pudo calcular ningún valor válido. Revisa la función o el intervalo.";
      return;
    }

    const minY = Math.min(...rango).toFixed(2);
    const maxY = Math.max(...rango).toFixed(2);
    const minX = Math.min(...dominio).toFixed(2);
    const maxX = Math.max(...dominio).toFixed(2);

    const resultado = `
      <strong>Dominio aproximado:</strong> [${minX}, ${maxX}]<br>
      <strong>Rango aproximado:</strong> [${minY}, ${maxY}]
    `;
    document.getElementById('resultado').innerHTML = resultado;

    // Gráfico
    if (chart) chart.destroy();
    const ctx = document.getElementById('grafico').getContext('2d');
    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: xVals,
        datasets: [{
          label: 'f(x)',
          data: yVals,
          borderColor: 'green',
          borderWidth: 2,
          pointRadius: 0,
          fill: false
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: { title: { display: true, text: 'x' }},
          y: { title: { display: true, text: 'f(x)' }}
        }
      }
    });
  }
</script>
