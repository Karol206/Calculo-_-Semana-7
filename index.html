<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Derivada por Definición (Paso a Paso)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 20px; }
    input, button { padding: 10px; margin: 10px 0; width: 300px; }
    #pasos { background: #fff; padding: 15px; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>Calculadora de Derivadas Paso a Paso</h1>
  <label>Ingresa la función (ej: 2*x^2):</label><br>
  <input type="text" id="funcion" value="2*x^2">
  <br>
  <button onclick="resolverDerivada()">Resolver Derivada</button>

  <h2>Pasos:</h2>
  <div id="pasos"></div>

  <h2>Gráfica:</h2>
  <div id="grafica" style="width:100%; height:400px;"></div>

<script>
function resolverDerivada() {
  const fInput = document.getElementById('funcion').value;
  const pasosDiv = document.getElementById('pasos');
  pasosDiv.innerHTML = "";

  try {
    const f = math.parse(fInput);
    const x = math.parse('x');
    const h = math.parse('h');

    const fx = f.compile();
    const fxh = math.parse(fInput.replace(/x/g, '(x + h)')).compile();

    const paso1 = `f(x) = ${fInput}`;

    const exprF_x_h = math.parse(fInput.replace(/x/g, '(x + h)'));
    const paso2 = `f(x + h) = ${exprF_x_h.toString()}`;

    const exprResta = math.simplify(`(${exprF_x_h.toString()}) - (${fInput})`);
    const paso3 = `f(x + h) - f(x) = ${exprResta.toString()}`;

    const exprDiv = math.simplify(`(${exprResta.toString()}) / h`);
    const paso4 = `(f(x + h) - f(x)) / h = ${exprDiv.toString()}`;

    const derivada = math.simplify(`limit(${exprDiv.toString()}, h, 0)`);
    const paso5 = `Derivada: f'(x) = ${derivada.toString()}`;

    pasosDiv.innerHTML += `<p><b>Paso 1:</b> ${paso1}</p>`;
    pasosDiv.innerHTML += `<p><b>Paso 2:</b> ${paso2}</p>`;
    pasosDiv.innerHTML += `<p><b>Paso 3:</b> ${paso3}</p>`;
    pasosDiv.innerHTML += `<p><b>Paso 4:</b> ${paso4}</p>`;
    pasosDiv.innerHTML += `<p><b>Paso 5:</b> ${paso5}</p>`;

    // Graficar funcion y derivada
    const fParsed = math.compile(fInput);
    const dParsed = math.compile(derivada.toString());

    const xs = math.range(-10, 10, 0.1).toArray();
    const ys = xs.map(x => fParsed.evaluate({x: x}));
    const dys = xs.map(x => dParsed.evaluate({x: x}));

    const trace1 = {
      x: xs,
      y: ys,
      mode: 'lines',
      name: 'f(x)',
      line: { color: 'blue' }
    };

    const trace2 = {
      x: xs,
      y: dys,
      mode: 'lines',
      name: "f'(x)",
      line: { color: 'red', dash: 'dot' }
    };

    Plotly.newPlot('grafica', [trace1, trace2], {
      title: 'Función y su Derivada',
      xaxis: { title: 'x' },
      yaxis: { title: 'y' }
    });
  } catch (e) {
    pasosDiv.innerHTML = '<p style="color:red;">Error al procesar la función. Asegúrate de escribirla correctamente.</p>';
  }
}
</script>
</body>
</html>
